<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Procurando Motorista â€“ RF Driver</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="core/global.js"></script>

<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
}

body{
  background:#000;
  color:#fff;
}

/* CONTAINER */
.container{
  min-height:100vh;
  padding:40px 20px 140px;
  max-width:420px;
  margin:0 auto;
  display:flex;
  flex-direction:column;
  justify-content:space-between;
}

/* LOGO */
.logo-wrapper{
  width:90px;
  height:90px;
  margin:0 auto 25px auto;
  border-radius:50%;
  background:#000;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 0 30px rgba(250,204,21,.35);
}

.logo-img{
  width:70%;
}

/* STATUS */
.status{
  text-align:center;
  margin-bottom:8px;
  font-size:1.3rem;
  font-weight:700;
}

.sub{
  text-align:center;
  font-size:.85rem;
  color:#a1a1aa;
  margin-bottom:25px;
}

/* CARD RESUMO */
.card{
  background:#111;
  border-radius:18px;
  padding:18px;
  border:1px solid #1c1c1c;
  margin-bottom:25px;
}

.route{
  text-align:center;
  font-size:.9rem;
  margin-bottom:15px;
}

.route strong{
  display:block;
  margin:6px 0;
}

.categoria{
  text-align:center;
  font-size:.85rem;
  color:#60a5fa;
  margin-bottom:12px;
}

.total{
  text-align:center;
  font-size:2.4rem;
  font-weight:800;
  color:#facc15;
  margin-top:10px;
}

/* LOADER MODERNO */
.loader{
  margin:20px auto;
  width:60px;
  height:60px;
  border-radius:50%;
  border:4px solid #1f2937;
  border-top:4px solid #2563eb;
  animation:spin 1s linear infinite;
}

@keyframes spin{
  to{ transform:rotate(360deg); }
}

/* TIMER */
.timer{
  text-align:center;
  font-size:.8rem;
  color:#94a3b8;
  margin-bottom:25px;
}

/* BOTÃ•ES FIXOS */
.cta-area{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  padding:20px;
  background:#000;
}

.btn{
  width:100%;
  padding:16px;
  border-radius:14px;
  border:none;
  font-weight:700;
  font-size:1rem;
  margin-bottom:12px;
  cursor:pointer;
  transition:.2s;
}

.btn-primary{
  background:#facc15;
  color:#000;
}

.btn-secondary{
  background:#111;
  border:1px solid #2563eb;
  color:#2563eb;
}

.btn-danger{
  background:#111;
  border:1px solid #ef4444;
  color:#ef4444;
}

.btn:active{
  transform:scale(.96);
}
</style>
</head>
<body>

<div class="container">

  <div>

    <div class="logo-wrapper">
      <img src="./icons/logo-1024.png" class="logo-img">
    </div>

    <div class="status" id="statusText">
      Procurando motorista...
    </div>

    <div class="sub">
      Estamos enviando sua solicitaÃ§Ã£o para motoristas prÃ³ximos
    </div>

<div class="card">

  <div class="timer" id="timer">
  Tempo de espera: 0s
</div>

  <div class="route">
    <strong id="origem"></strong>
    â†“
    <strong id="destino"></strong>
  </div>

  <div class="categoria" id="categoria"></div>

  <div style="margin-top:15px; font-size:.85rem;" id="detalhamentoBox"></div>

  <div id="observacaoBox" style="margin-top:12px; display:none;">
    <div style="font-size:.75rem; color:#a1a1aa; margin-bottom:4px;">
      ObservaÃ§Ã£o
    </div>
    <div style="font-size:.85rem;" id="observacaoTxt"></div>
  </div>

  <div class="total" id="total"></div>

</div>

  </div>

</div>

<div class="cta-area">

  <button class="btn btn-secondary" onclick="aumentarOferta()">
    Oferecer valor maior
  </button>

  <button class="btn btn-danger" onclick="cancelar()">
    Cancelar corrida
  </button>

</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="core/supabase.js"></script>

<script>
const origem = App.get("origem") || "-";
const destino = App.get("destino") || "-";
const total = Number(App.get("total") || 0);
const categoriaSelecionada = App.get("categoria") || "Categoria padrÃ£o";
const config = App.get("taxasConfig") || {};
const valorBase = Number(App.get("valorBase") || 0);

document.getElementById("origem").innerText = origem;
document.getElementById("destino").innerText = destino;
document.getElementById("total").innerText = "R$ " + total.toFixed(2);
document.getElementById("categoria").innerText = categoriaSelecionada;

// ==========================
// DETALHAMENTO
// ==========================

let detalhes = [];

detalhes.push(["Valor base", valorBase]);

if(config.tipoViagem === "bate_volta")
  detalhes.push(["Bate e volta", valorBase]);

if(config.tipoViagem === "ida_volta")
  detalhes.push(["Ida e volta", valorBase]);

if(config.tipoViagem === "ida_volta_espera"){
  const acres = valorBase + (valorBase * 0.10);
  detalhes.push(["Ida e volta + espera", acres]);
}

if(config.desvioSimples)
  detalhes.push(["Desvio rÃ¡pido", 5]);

if(config.voltaPraia)
  detalhes.push(["Volta das praias", 10]);

if(config.taxaFeira)
  detalhes.push(["Taxa de feira", 5]);

// ðŸ”¥ Adicional noturno
if(config.taxaNoturna){
  let acres = 0;

  if(valorBase <= 29){
    acres = 5;
    detalhes.push(["Adicional noturno", 5]);
  }else{
    acres = valorBase * 0.35;
    detalhes.push(["Adicional noturno (35%)", acres]);
  }
}

if(Number(config.animal) > 0)
  detalhes.push(["Transporte animal", Number(config.animal)]);

if(Number(config.minutosEspera) >= 5){
  const min = Number(config.minutosEspera);
  const acres = 3 + ((min - 5) * 0.60);
  detalhes.push([`Tempo de espera (${min} min)`, acres]);
}

// Render detalhamento
document.getElementById("detalhamentoBox").innerHTML =
  detalhes.map(d => `
    <div style="display:flex; justify-content:space-between; margin-bottom:6px;">
      <span>${d[0]}</span>
      <strong>R$ ${Number(d[1]).toFixed(2)}</strong>
    </div>
  `).join("");

// ==========================
// OBSERVAÃ‡ÃƒO
// ==========================

if(config.observacao && config.observacao.trim() !== ""){
  document.getElementById("observacaoBox").style.display = "block";
  document.getElementById("observacaoTxt").innerText = config.observacao;
}

// ==========================
// TIMER
// ==========================

let segundos = 0;
setInterval(()=>{
  segundos++;
  document.getElementById("timer").innerText =
    "Tempo de espera: " + segundos + "s";
},1000);

// ==========================
// AUMENTAR OFERTA
// ==========================

function aumentarOferta(){
  let novo = prompt("Digite o novo valor da oferta:", total.toFixed(2));

  if(novo && !isNaN(novo) && Number(novo) > total){
    App.set("total", Number(novo));
    location.reload();
  }else{
    alert("Digite um valor maior que o atual.");
  }
}

// ==========================
// CANCELAR
// ==========================

function cancelar(){
  if(confirm("Deseja cancelar a corrida?")){
    App.reset();
    App.go("index.html");
  }
}
</script>

</body>
</html>
