<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dashboard - Motorista App</title>

<style>
/* ====== PALLETE ====== */
:root {
    --bg: #ffffff;
    --page-gap: #f3f5f8;
    --card: #fafbfc;
    --card-strong: #f0f2f5;
    --panel: #ffffff;
    --brand: #0b5bd7;
    --brand-dark: #073f8a;
    --accent-success: #1DB954;
    --accent-danger: #ff3b30;
    --muted: #65707a;
    --text: #0b1115;
    --shadow: 0 6px 16px rgba(13,30,45,0.07);
    --shadow-strong: 0 10px 32px rgba(10,20,30,0.12);
    --radius: 14px;
}

/* ====== DARK ====== */
.dark{
    --bg:#0f1115;
    --page-gap:#15171c;
    --card:#181a20;
    --card-strong:#1d1f27;
    --panel:#1b1d25;
    --text:#e5e7eb;
    --muted:#9ca3af;
    --shadow:0 6px 16px rgba(0,0,0,0.35);
    --shadow-strong:0 10px 32px rgba(0,0,0,0.45);
}

/* ====== BASE ====== */
body{
    margin:0;
    background:linear-gradient(180deg,var(--page-gap),var(--bg) 50%);
    color:var(--text);
    padding-bottom:160px;
    padding-top:70px;
    font-family: Inter,Roboto,Arial,sans-serif;
}
*{box-sizing:border-box}

/* ====== MENU SUPERIOR ====== */
.top-menu{
  position:fixed;top:0;left:0;width:100%;
  background:var(--panel);
  display:flex;
  padding:8px;
  gap:8px;
  align-items:center;
  z-index:9999;
  overflow-x:auto;
  box-shadow:var(--shadow);
}
.top-menu button{
  padding:10px 14px;
  background:var(--card);
  border:1px solid rgba(0,0,0,0.08);
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
  flex-shrink:0;
  color:var(--text);
}

/* ====== HEADER ====== */
header{
    padding:18px 16px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    max-width:980px;
    margin:12px auto;
}

/* ====== CONTAINER ====== */
.container{ max-width:980px; margin:0 auto; padding:0 16px; }

/* ===== FILTROS ===== */
.period-filters{
    display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap;
}
.period-btn{
    width:auto;padding:8px 12px;font-size:12px;
    border-radius:999px;border:1px solid #d7dce2;
    background:var(--panel);color:var(--muted);
}
.period-btn.active{
    background:linear-gradient(135deg,var(--brand),var(--brand-dark));
    color:#fff;border:none;
}
.period-range{
    display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-bottom:14px;
}
.period-range input[type="date"]{
    padding:6px 8px;border-radius:8px;border:1px solid #cfd4da;background:var(--panel);
}
.period-apply{
    width:auto;padding:8px 12px;font-size:12px;
}
.period-note{font-size:12px;color:var(--muted);margin-bottom:10px;}

/* ====== CARD LUCRO ====== */
.card-lucro{
    background:var(--card-strong);
    border-radius:var(--radius);
    padding:24px;
    border:3px solid transparent;
    box-shadow:var(--shadow-strong);
    margin:14px 0 20px;
}
.card-lucro.positivo{border-color:var(--accent-success);}
.card-lucro.negativo{border-color:var(--accent-danger);}
.card-lucro .label{ font-size:14px; color:var(--muted); }
.card-lucro .valor{ font-size:34px; font-weight:900; margin-top:6px; }
.card-lucro .sub{ font-size:13px; color:var(--muted); }

/* ===== SMALL CARDS ===== */
.row{ display:flex; gap:14px; flex-wrap:wrap; }
.card-small{
    flex:1; min-width:200px;
    background:var(--card);
    border-radius:var(--radius);
    padding:18px;
    box-shadow:var(--shadow);
    border:1px solid #e2e7ec;
}
.card-small .title{ font-size:13px; color:var(--muted); }
.card-small .value{ font-size:22px; font-weight:900; color:var(--brand); margin-top:6px; }
.card-small .gastos{ color:var(--accent-danger)!important; }
</style>
</head>

<body>

<!-- MENU SUPERIOR -->
<div class="top-menu">
  <button onclick="location.href='planos.html'">üíé Planos</button>
  <button onclick="location.href='perfil.html'">üë§ Perfil</button>
  <button onclick="location.href='index.html'">üè† Dashboard</button>
  <button onclick="location.href='entradas.html'">üíµ Caixa</button>
  <button onclick="location.href='resumo.html'">üßÆ Resumo</button>
  <button onclick="location.href='recibo_empresa.html'">üè≠ Empresa</button>
  <button onclick="location.href='recibo_particular.html'">üöò Particular</button>
  <button onclick="location.href='manutencao.html'">üõ† Manuten√ß√£o</button>
  <button onclick="location.href='calculadora.html'">üìü Calculadora</button>
</div>

<header>
    <div class="brand">
        <div class="logo">RF Driver</div>
        <h1>Dashboard</h1>
    </div>
  <button id="toggleTheme">üåô</button>
</header>

<div class="container">

    <!-- FILTRO -->
    <div class="period-filters">
        <button class="period-btn active" id="btnHoje">Hoje</button>
        <button class="period-btn" id="btnSemana">Semana</button>
        <button class="period-btn" id="btnMes">M√™s</button>
        <button class="period-btn" id="btnPers">Per√≠odo</button>
    </div>

    <div class="period-range" id="rangePers" style="display:none">
        <input type="date" id="ini">
        <input type="date" id="fim">
        <button class="period-apply" id="applyPers">Aplicar</button>
    </div>

    <div class="period-note" id="periodNote">Mostrando dados de hoje</div>

    <div id="cardLucro" class="card-lucro">
        <div>
            <div class="label">Lucro Estimado</div>
            <div id="lucroValor" class="valor">R$ 0,00</div>
            <div class="sub">Vis√£o l√≠quida</div>
        </div>
    </div>

    <div class="row">
        <div class="card-small">
            <div class="title">Gastos</div>
            <div id="gastos" class="value gastos">R$ 0,00</div>
        </div>

        <div class="card-small">
            <div class="title">Faturado</div>
            <div id="fat" class="value">R$ 0,00</div>
        </div>
    </div>

</div>

<script src="planos.js"></script>
<script>

/* BLOQUEIO IMEDIATO SE FOR FREE */
function plano(){
  try{ return getPlano(); }catch(e){}
  return (localStorage.getItem('planoAtual')||'free').toLowerCase();
}
if(plano()==='free'){
   alert("O Dashboard √© liberado apenas no plano B√ÅSICO ou superior.");
   window.location.href = "planos.html";
}

/* theme */
function applyTheme(theme){
    if(theme==='dark'){
        document.documentElement.classList.add('dark');
        localStorage.setItem('theme','dark');
        toggleTheme.innerText='‚òÄÔ∏è';
    }else{
        document.documentElement.classList.remove('dark');
        localStorage.setItem('theme','light');
        toggleTheme.innerText='üåô';
    }
}
const saved=localStorage.getItem('theme')||'light';
applyTheme(saved);
toggleTheme.onclick=()=>{
    const d=document.documentElement.classList.contains('dark');
    applyTheme(d?'light':'dark');
};

/* STATE */
let periodo='hoje';
let ini=null,fim=null;

/* filtros */
function block(p){
 if(p==='semana' && plano()==='free'){
   alert('Semana dispon√≠vel a partir do B√°sico');
   location.href='planos.html';return true;}
 if((p==='mes'||p==='pers') && (plano()==='free'||plano()==='basico')){
   alert('M√™s e Per√≠odo dispon√≠veis a partir do Premium');
   location.href='planos.html';return true;}
 return false;
}

/* carregar registros */
function load(){
 return JSON.parse(localStorage.getItem('entradasSaidas')||'[]');
}

function norm(d){return new Date(d.getFullYear(),d.getMonth(),d.getDate());}

function ok(r){
 const d=new Date(r.criadoEm);if(isNaN(d))return true;
 const h=norm(new Date());
 const dn=norm(d);
 if(periodo==='hoje')return dn.getTime()===h.getTime();
 if(periodo==='semana'){
   const lim=new Date(h);lim.setDate(lim.getDate()-6);
   return dn>=lim && dn<=h;
 }
 if(periodo==='mes'){
   return d.getMonth()===h.getMonth() && d.getFullYear()===h.getFullYear();
 }
 if(periodo==='pers'){
   if(!ini||!fim)return true;
   const d0=norm(ini),d1=norm(fim);
   return dn>=d0 && dn<=d1;
 }
 return true;
}

function render(){
 const regs=load().filter(ok);
 let entr=0,said=0;
 regs.forEach(r=>{
   if(r.tipo==='entrada')entr+=Number(r.valor||r.valorBruto||0);
   else said+=Number(r.valor||0);
 });
 $('fat').innerText=fmt(entr);
 $('gastos').innerText=fmt(said);
 const lucro=entr-said;
 $('lucroValor').innerText=fmt(lucro);
 const card=$('cardLucro');
 card.classList.remove('positivo','negativo');
 card.classList.add(lucro>=0?'positivo':'negativo');
}

function $(id){return document.getElementById(id);}
function fmt(v){return Number(v||0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});}

$('btnHoje').onclick=()=>{periodo='hoje';updateUI();render();}
$('btnSemana').onclick=()=>{if(block('semana'))return;periodo='semana';updateUI();render();}
$('btnMes').onclick=()=>{if(block('mes'))return;periodo='mes';updateUI();render();}
$('btnPers').onclick=()=>{if(block('pers'))return;periodo='pers';updateUI();render();}
$('applyPers').onclick=()=>{
  ini=$('ini').value?new Date($('ini').value):null;
  fim=$('fim').value?new Date($('fim').value):null;
  if(!ini||!fim){alert('Selecione datas');return;}
  if(ini>fim){alert('In√≠cio maior que final');return;}
  periodo='pers';updateUI();render();
};

function updateUI(){
 ['btnHoje','btnSemana','btnMes','btnPers'].forEach(id=>$ (id).classList.remove('active'));
 if(periodo==='hoje')$('btnHoje').classList.add('active');
 if(periodo==='semana')$('btnSemana').classList.add('active');
 if(periodo==='mes')$('btnMes').classList.add('active');
 if(periodo==='pers')$('btnPers').classList.add('active');

 $('rangePers').style.display=periodo==='pers'?'flex':'none';
 const note=$('periodNote');
 if(periodo==='hoje')note.innerText='Mostrando dados de hoje';
 if(periodo==='semana')note.innerText='Mostrando √∫ltimos 7 dias';
 if(periodo==='mes')note.innerText='Mostrando m√™s atual';
 if(periodo==='pers')note.innerText='Mostrando per√≠odo selecionado';
}

updateUI();
render();
</script>

</body>
</html>
