<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Recibo Particular - Fluxo Driver</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
    --bg:#ffffff;
    --page-gap:#f3f5f8;
    --card:#fafbfc;
    --card-strong:#f0f2f5;
    --panel:#ffffff;
    --brand:#0b5bd7;
    --brand-dark:#073f8a;
    --text:#0b1115;
    --muted:#65707a;
    --radius:14px;
    --shadow:0 6px 16px rgba(13,30,45,0.07);
}
.dark{
    --bg:#0f1115;
    --page-gap:#15171c;
    --card:#181a20;
    --card-strong:#1d1f27;
    --panel:#1b1d25;
    --text:#e5e7eb;
    --muted:#9ca3af;
    --brand:#3b82f6;
    --brand-dark:#2563eb;
    --shadow:0 6px 16px rgba(0,0,0,0.35);
}

/* BASE */
*{ box-sizing:border-box; }
body{
    margin:0;
    font-family:Inter,Roboto,Arial,sans-serif;
    background:linear-gradient(180deg,var(--page-gap),var(--bg) 50%);
    color:var(--text);
    padding-bottom:160px;
    padding-top:100px; /* espa√ßo pro menu superior */
}

/* MENU SUPERIOR */
.top-menu{
  position:fixed;
  top:0;left:0;width:100%;
  background:var(--panel);
  display:flex;
  padding:8px;
  gap:8px;
  align-items:center;
  z-index:9999;
  overflow-x:auto;
  box-shadow:var(--shadow);
}
.top-menu button{
  padding:10px 14px;
  background:var(--card);
  border:1px solid rgba(0,0,0,0.08);
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
  flex-shrink:0;
  color:var(--text);
}

/* HEADER */
header{
    padding:18px 16px;
    max-width:980px;
    margin:0 auto;
    display:flex;
    align-items:center;
    justify-content:space-between;
}
.brand{
    display:flex;align-items:center;gap:12px;
}

#toggleTheme{
    background:var(--card-strong);
    padding:8px 12px;border-radius:10px;
    border:1px solid rgba(0,0,0,.15);
    font-weight:700;color:var(--text);
    cursor:pointer;
}

/* CONTAINER */
.container{max-width:980px;margin:0 auto;padding:0 16px;}

/* TABS */
.tabs{
    display:flex;
    gap:10px;
    margin-bottom:16px;
}
.tab{
    flex:1;text-align:center;padding:12px;background:var(--card);
    border-radius:var(--radius);font-weight:700;
    cursor:pointer;color:var(--muted);
    border:1px solid #d7dce2;transition:.25s;
}
.tab.active{
    background:linear-gradient(135deg,var(--brand),var(--brand-dark));
    color:#fff;border:none;
}

/* CARD */
.card{
    background:var(--card);
    border-radius:var(--radius);
    padding:20px;margin-bottom:18px;
    border:1px solid #d7dce2;box-shadow:var(--shadow);
}
.card h3{margin-top:0;margin-bottom:12px;}

/* INPUTS */
.form input,.form select,.form textarea{
    width:100%;padding:12px;border-radius:10px;
    border:1px solid #cfd4da;background:var(--panel);
    color:var(--text);margin-bottom:12px;font-size:15px;
}
textarea{resize:vertical;min-height:80px}

/* HIST√ìRICO LISTA */
.hist-item{
    background:var(--card-strong);
    padding:10px;
    border-radius:10px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:8px;
    font-size:14px;
}
.hist-main{
    display:flex;
    flex-direction:column;
    gap:2px;
}
.hist-main strong{font-size:14px;}
.hist-main span{font-size:12px;color:var(--muted);}
.hist-actions{
    display:flex;
    flex-direction:column;
    gap:6px;
}
.btn-sm{
    padding:6px 50px;
    border-radius:8px;
    border:none;
    font-size:12px;
    font-weight:700;
    cursor:pointer;
}
.btn-sm.pdf{background:linear-gradient(135deg,var(--brand),var(--brand-dark));color:#fff;}
.btn-sm.del{background:#e11d48;color:#fff;}

/* BOT√ÉO PADR√ÉO */
button{
    width:17%;padding:14px;border:none;border-radius:10px;
    font-size:15px;font-weight:700;cursor:pointer;
    background:linear-gradient(135deg,var(--brand),var(--brand-dark));
    color:#fff;
}
</style>
</head>

<body>

<!-- MENU SUPERIOR -->
<div class="top-menu">
  <button onclick="location.href='planos.html'">üíé Planos</button>
  <button onclick="location.href='perfil.html'">üë§ Perfil</button>
  <button onclick="location.href='index.html'">üè† Dashboard</button>
  <button onclick="location.href='entradas.html'">üíµ Caixa</button>
  <button onclick="location.href='resumo.html'">üßÆ Resumo</button>
  <button onclick="location.href='recibo_empresa.html'">üè≠ Empresa</button>
  <button onclick="location.href='recibo_particular.html'">üöò Particular</button>
  <button onclick="location.href='manutencao.html'">üõ† Manuten√ß√£o</button>
  <button onclick="location.href='calculadora.html'">üìü Calculadora</button>
</div>

<header>
    <div class="brand">
        <div class="logo">RF Driver</div>
        <h1 style="margin:0;font-size:30px;font-weight:800">Recibo Particular</h1>
    </div>

  <button id="toggleTheme">üåô</button>
</header>

<div class="container">

  <!-- TABS -->
  <div class="tabs">
      <div class="tab" data-tab="cadastro">Cadastro</div>
      <div class="tab active" data-tab="emitir">Emitir Recibo</div>
      <div class="tab" data-tab="historico">Hist√≥rico</div>
  </div>

  <!-- =============== TAB - CADASTRO ================= -->
  <div id="tab-cadastro" class="card" style="display:none;">
    <h3>Dados do motorista</h3>
    <div class="form">
      <input id="motNome" placeholder="Nome do motorista">
      <input id="motCpf" placeholder="CPF ou CNPJ (opcional)">
      <input id="motVeiculo" placeholder="Ve√≠culo">
      <input id="motPlaca" placeholder="Placa">
      <input id="motCor" placeholder="Cor">
      <button id="saveMotorista">Salvar motorista</button>
    </div>
  </div>

  <!-- =============== TAB - EMITIR ================= -->
  <div id="tab-emitir" class="card">
    <h3>Dados do passageiro</h3>
    <div class="form">
      <input id="nomePassageiro" placeholder="Nome do passageiro">
      <input id="origem" placeholder="Origem">
      <input id="destino" placeholder="Destino">

      <h3 style="margin-top:20px;">Dados da viagem</h3>

      <input id="valor" type="number" step="0.01" placeholder="Valor (R$)">
      <input id="dataViagem" type="date" placeholder="Data da viagem">
      <input id="tempo" placeholder="Tempo aproximado (ex: 35 min)">
      <input id="km" type="number" step="0.1" placeholder="KM aproximado">

      <button id="emitirPdf">Gerar PDF</button>
      <button id="enviarWa" style="background:#128c7e;margin-top:10px;">Enviar WhatsApp</button>
    </div>
  </div>

  <!-- =============== TAB - HIST√ìRICO ================= -->
  <div id="tab-historico" class="card" style="display:none;">
    <h3>Hist√≥rico de recibos</h3>
    <div id="lista"></div>
  </div>

</div>

<script>
/* ===================================================
   BLOQUEIO DE PLANO
   =================================================== */
function plano(){
  try{ return getPlano(); }catch(e){}
  return (localStorage.getItem('planoAtual')||'free').toLowerCase();
}

(function(){
  const p = plano();
  if(p!=='premium' && p!=='pro'){
     alert("A p√°gina Recibo Particular est√° dispon√≠vel a partir do plano Premium.");
     window.location.href="planos.html";
     return;
  }
})();

/* ===================================================================
   Controls de habilitar/desabilitar recursos
   =================================================================== */
function aplicarPermissoes(){
  const p = plano();
  const btnPdf = document.getElementById("emitirPdf");

  // Premium: bloqueia PDF
  if(p==='premium'){
     if(btnPdf){
        btnPdf.disabled = true;
        btnPdf.style.opacity = ".4";
        btnPdf.innerText = "PDF (Pro)";
     }
  }

  // Pro: tudo liberado
}

/* ==========================
   THEME
   ========================== */
function applyTheme(theme){
  const btn = document.getElementById("toggleTheme");
  if(theme === "dark"){
    document.documentElement.classList.add("dark");
    localStorage.setItem("theme","dark");
    if(btn) btn.innerText = "‚òÄÔ∏è";
  } else {
    document.documentElement.classList.remove("dark");
    localStorage.setItem("theme","light");
    if(btn) btn.innerText = "üåô";
  }
}
(function initTheme(){
  const saved = localStorage.getItem("theme") || "light";
  applyTheme(saved);
  const btn = document.getElementById("toggleTheme");
  if(btn){
    btn.addEventListener("click", ()=>{
      const isDark = document.documentElement.classList.contains("dark");
      applyTheme(isDark ? "light" : "dark");
    });
  }
})();

/* ==========================
   TABS
   ========================== */
const $ = id => document.getElementById(id);

function setActiveTab(name){
  document.querySelectorAll(".tab").forEach(t=>{
    t.classList.toggle("active", t.dataset.tab === name);
  });
  $("tab-cadastro").style.display  = (name === "cadastro" ? "block" : "none");
  $("tab-emitir").style.display    = (name === "emitir" ? "block" : "none");
  $("tab-historico").style.display = (name === "historico" ? "block" : "none");
}
document.querySelectorAll(".tab").forEach(tab=>{
  tab.addEventListener("click", ()=> setActiveTab(tab.dataset.tab));
});
setActiveTab("emitir");

/* ==========================
   STORAGE
   ========================== */
const KEY = "histParticular";

function load(){
  try { return JSON.parse(localStorage.getItem(KEY) || "[]"); }
  catch(e){ return []; }
}
function save(list){
  localStorage.setItem(KEY, JSON.stringify(list));
}

/* ===== Motorista ===== */
function getMotorista(){
  try { return JSON.parse(localStorage.getItem("motoristaParticular") || "{}"); }
  catch(e){ return {}; }
}
function fillMotorista(){
  const m = getMotorista();
  if($("motNome"))    $("motNome").value    = m.nome    || "";
  if($("motCpf"))     $("motCpf").value     = m.cpf     || "";
  if($("motVeiculo")) $("motVeiculo").value = m.veiculo || "";
  if($("motPlaca"))   $("motPlaca").value   = m.placa   || "";
  if($("motCor"))     $("motCor").value     = m.cor     || "";
}
if($("saveMotorista")){
  $("saveMotorista").addEventListener("click", ()=>{
    const data = {
      nome:    $("motNome")?.value    || "",
      cpf:     $("motCpf")?.value     || "",
      veiculo: $("motVeiculo")?.value || "",
      placa:   $("motPlaca")?.value   || "",
      cor:     $("motCor")?.value     || ""
    };
    localStorage.setItem("motoristaParticular", JSON.stringify(data));
    alert("Dados do motorista salvos!");
  });
}

/* ===== Hist√≥rico ===== */
function excluir(id){
  if(!confirm("Excluir este recibo?")) return;
  let arr = load();
  arr = arr.filter(x => x.id !== id);
  save(arr);
  render();
}
window.excluir = excluir;

function render(){
  const lista = $("lista");
  const arr = load();
  if(!lista) return;
  if(!arr.length){
    lista.innerHTML = "<div style='font-size:13px;color:var(--muted)'>Sem registros.</div>";
    return;
  }
  lista.innerHTML = arr.map(r=>`
    <div class="hist-item">
      <div class="hist-main">
        <strong>${r.data || "-"}</strong>
        <span>${r.nome || "-"}</span>
      </div>
      <div class="hist-actions">
        <button class="btn-sm pdf" onclick="baixar(${r.id})">PDF</button>
        <button class="btn-sm del" onclick="excluir(${r.id})">Excluir</button>
      </div>
    </div>
  `).join("");
}

/* ===== PDF ===== */
function gerarPDF(d){
 const p = plano();
 if(p !== 'pro'){ 
   alert("PDF dispon√≠vel apenas no plano PRO");
   return;
 }

 const m = getMotorista();
 const {jsPDF} = window.jspdf;
 const doc = new jsPDF('p','mm','a4');
 const W   = doc.internal.pageSize.getWidth();
 let y  = 15, mx = 15;

 doc.setFontSize(18);
 doc.text("RECIBO DE VIAGEM PARTICULAR", W/2, y, {align:"center"});
 y += 10;

 function box(titulo, linhas){
   const lh = 5;
   const h  = 8 + linhas.length*lh + 4;
   doc.setDrawColor(150);
   doc.roundedRect(mx, y, W-mx*2, h, 2, 2);
   doc.setFontSize(12);
   doc.text(titulo, mx+3, y+6);
   doc.setFontSize(10);
   let ty = y+12;
   linhas.forEach(l=>{
     doc.text(l || "", mx+4, ty);
     ty += lh;
   });
   y += h+4;
 }

 box("Motorista",[
   "Nome: "      + (m.nome    || "-"),
   "CPF/CNPJ: "  + (m.cpf     || "-"),
   "Ve√≠culo: "   + (m.veiculo || "-"),
   "Placa: "     + (m.placa   || "-"),
   "Cor: "       + (m.cor     || "-")
 ]);

 box("Passageiro",[
   "Nome: "   + (d.nome   || "-"),
   "Origem: " + (d.origem || "-"),
   "Destino: "+ (d.destino|| "-")
 ]);

 box("Dados da viagem",[
   "Data: "  + (d.data  || "-"),
   "Valor: R$ " + (d.valor || "-"),
   "Tempo: " + (d.tempo || "-"),
   "KM: "    + (d.km    || "-")
 ]);

 y += 8;

 doc.text("__________________________________", mx, y);
 const mx2 = mx + 90;
 doc.text("__________________________________", mx2, y);
 y += 6;
 doc.text((d.nome || "-"), mx, y);
 doc.text((m.nome || "-"), mx2, y);

 doc.save("recibo_particular.pdf");
}

/* ===== EMITIR ===== */
function baixar(id){
 const p = plano();
 if(p!=='pro'){
   alert("Download dispon√≠vel apenas no plano PRO");
   return;
 }
 const arr = load();
 const d = arr.find(x=>x.id===id);
 if(d) gerarPDF(d);
}
window.baixar = baixar;

const btnPdf = $("emitirPdf");
const btnWa  = $("enviarWa");

if(btnPdf){
  btnPdf.addEventListener("click", ()=>{
    const d = {
      id:     Date.now(),
      nome:   $("nomePassageiro")?.value || "",
      origem: $("origem")?.value        || "",
      destino:$("destino")?.value       || "",
      valor:  $("valor")?.value         || "",
      data:   $("dataViagem")?.value    || "",
      tempo:  $("tempo")?.value         || "",
      km:     $("km")?.value            || ""
    };

    const p = plano();
    if(p==="pro"){
      gerarPDF(d);
    }else{
      alert("Para gerar PDF, voc√™ precisa do plano PRO");
      return;
    }

    let arr = load();
    arr.unshift(d);
    save(arr);
    render();
    setActiveTab("historico");
  });
}

if(btnWa){
  btnWa.addEventListener("click", ()=>{
    const p = plano();
    if(p==='premium' || p==='pro'){
      const msg =
`RECIBO PARTICULAR

Passageiro: ${$("nomePassageiro").value}
Origem: ${$("origem").value}
Destino: ${$("destino").value}
Data: ${$("dataViagem").value}
Valor: R$ ${$("valor").value}
Tempo: ${$("tempo").value}
KM: ${$("km").value}`;

      window.open("https://wa.me/?text="+encodeURIComponent(msg));
    }else{
      alert("WhatsApp dispon√≠vel apenas no plano Premium +");
    }
  });
}

/* ===== Boot ===== */
document.addEventListener("DOMContentLoaded", ()=>{
  aplicarPermissoes();
  fillMotorista();
  render();
});
</script>

</body>
</html>
