<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Resumo ‚Äì RF DRIVER</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="core/global.js"></script>
<script src="core/dinamico.js"></script>
  
<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
}

body{
  background:#000;
  color:#fff;
}

.container{
  padding:30px 20px 140px;
  max-width:420px;
  margin:0 auto;
}

.logo-wrapper{
  width:90px;
  height:90px;
  margin:0 auto 20px auto;
  border-radius:50%;
  background:#000;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 0 30px rgba(250,204,21,.35);
}

.logo-img{
  width:70%;
}

.header{
  text-align:center;
  margin-bottom:25px;
}

.header h1{
  font-size:1.4rem;
  font-weight:700;
}

.header span{
  font-size:.85rem;
  color:#a1a1aa;
}

.card{
  background:#111;
  border-radius:16px;
  padding:16px;
  border:1px solid #1c1c1c;
  margin-bottom:18px;
}

.section-title{
  font-size:.85rem;
  color:#a1a1aa;
  margin-bottom:10px;
}

.route span{
  display:block;
  margin-bottom:6px;
}

.details div{
  display:flex;
  justify-content:space-between;
  margin-bottom:6px;
  font-size:.9rem;
}

.total-box{
  background:#151515;
  border:1px solid #facc15;
  border-radius:18px;
  padding:20px;
  text-align:center;
  margin-bottom:20px;
}

.total{
  font-size:2.2rem;
  font-weight:800;
  color:#facc15;
}

select{
  width:100%;
  padding:14px;
  border-radius:14px;
  background:#111;
  color:#fff;
  border:1px solid #1c1c1c;
}

.cta-area{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  padding:20px;
  background:#000;
}

.cta-primary{
  width:100%;
  padding:18px;
  border:none;
  border-radius:14px;
  font-size:1.05rem;
  font-weight:700;
  background:#facc15;
  color:#000;
  cursor:pointer;
}

.categoria-item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px;
  border-radius:14px;
  border:1px solid #1c1c1c;
  background:#0d0d0d;
  margin-bottom:10px;
  cursor:pointer;
  transition:.2s;
}

.categoria-item:hover{
  border-color:#facc15;
}

.categoria-item.active{
  border-color:#facc15;
  background:#151515;
}

.categoria-item strong{
  font-size:1rem;
}

.categoria-item span{
  font-size:1rem;
  font-weight:700;
}
</style>
</head>

<body>

<div class="container">

  <div class="logo-wrapper">
    <img src="./icons/logo-1024.png" class="logo-img">
  </div>

  <div class="header">
    <h1>Resumo da Viagem</h1>
    <span>Confirme as informa√ß√µes</span>
  </div>

  <!-- CATEGORIAS -->
  <div class="card">
    <div class="section-title">Escolha sua categoria</div>
    <div id="listaCategorias"></div>
  </div>
  
  <!-- ROTA -->
  <div class="card route">
    <div class="section-title">Itiner√°rio</div>
    <span>üìå Origem: <strong id="origemTxt"></strong></span>
    <span>üèÅ Destino: <strong id="destinoTxt"></strong></span>
  </div>

  <!-- DETALHAMENTO -->
  <div class="card">
    <div class="section-title">Detalhamento</div>
    <div class="details" id="detalhamento"></div>
  </div>

  <!-- PAGAMENTO -->
  <div class="card">
    <div class="section-title">Forma de Pagamento</div>
    <select id="formaPagamento">
      <option value="Dinheiro">Dinheiro</option>
      <option value="Pix">Pix</option>
      <option value="Cart√£o">Cart√£o</option>
    </select>
  </div>

  <!-- TOTAL -->
  <div class="total-box">
    <div class="total" id="total">R$ 0,00</div>
  </div>

</div>

<div class="cta-area">
  <button class="cta-primary" onclick="solicitar()">
    Solicitar Viagem
  </button>
</div>

<script>

// ==========================
// DADOS BASE
// ==========================
const origem = App.get("origem");
const destino = App.get("destino");
const valorBase = Number(App.get("valorBase") || 0);
const config = App.get("taxasConfig") || {};

document.getElementById("origemTxt").innerText = origem || "-";
document.getElementById("destinoTxt").innerText = destino || "-";

// ==========================
// C√ÅLCULO BASE (SEM CATEGORIA)
// ==========================
let totalBase = valorBase;
let detalhesBase = [];

if(config.desvioSimples){
  totalBase += 5;
  detalhesBase.push(["Desvio r√°pido",5]);
}

if(config.taxaFeira){
  totalBase += 5;
  detalhesBase.push(["Taxa de feira",5]);
}

if(Number(config.animal) > 0){
  totalBase += Number(config.animal);
  detalhesBase.push(["Transporte animal",Number(config.animal)]);
}

function estaNoHorarioNoturno(){
  const agora = new Date();
  const totalMinutos = agora.getHours()*60 + agora.getMinutes();
  const inicio = 22*60+30;
  const fim = 5*60;
  return (totalMinutos >= inicio || totalMinutos <= fim);
}

if(estaNoHorarioNoturno()){
  let acres = totalBase <= 29 ? 5 : totalBase * 0.35;
  totalBase += acres;
  detalhesBase.push(["Adicional noturno autom√°tico", acres]);
}

if (typeof Dinamico !== "undefined" && Dinamico.ativo) {
  const novoTotal = totalBase * Dinamico.multiplicador;
  const acrescimo = novoTotal - totalBase;
  totalBase = novoTotal;
  detalhesBase.push([`Tarifa din√¢mica`, acrescimo]);
}

// ==========================
// CATEGORIAS
// ==========================
const categorias = [
  { nome:"Hatch", multi:1.0 },
  { nome:"Sedan", multi:1.1 },
  { nome:"SUV / Confort", multi:1.2 },
  { nome:"6 Lugares", multi:1.5 },
  { nome:"Entregas / Envios", multi:1.0 }
];

let categoriaSelecionada = null;
let totalFinal = totalBase;

const listaCategorias = document.getElementById("listaCategorias");

listaCategorias.innerHTML = categorias.map(cat=>{
  const valor = totalBase * cat.multi;
  return `
    <div class="categoria-item"
         data-nome="${cat.nome}"
         data-multi="${cat.multi}"
         data-valor="${valor}">
      <strong>${cat.nome}</strong>
      <span>R$ ${valor.toFixed(2)}</span>
    </div>
  `;
}).join("");

document.querySelectorAll(".categoria-item").forEach(item=>{
  item.addEventListener("click",()=>{

    document.querySelectorAll(".categoria-item")
      .forEach(i=>i.classList.remove("active"));

    item.classList.add("active");

    categoriaSelecionada = item.dataset.nome;
    totalFinal = Number(item.dataset.valor);

    atualizarDetalhamento();
  });
});

// ==========================
// DETALHAMENTO
// ==========================
function atualizarDetalhamento(){

  if(!categoriaSelecionada) return;

  let detalhes = [];
  detalhes.push(["Categoria", categoriaSelecionada]);

  detalhesBase.forEach(d=>detalhes.push(d));

  document.getElementById("detalhamento").innerHTML =
    detalhes.map(d=>`
      <div>
        <span>${d[0]}</span>
        <strong>${
          typeof d[1]==="number"
          ? "R$ "+Number(d[1]).toFixed(2)
          : d[1]
        }</strong>
      </div>
    `).join("");

  document.getElementById("total").innerText =
    `R$ ${totalFinal.toFixed(2)}`;

  App.set("categoria", categoriaSelecionada);
  App.set("total", totalFinal);
}

// ==========================
// SOLICITAR
// ==========================
function solicitar(){
  if(!categoriaSelecionada){
    alert("Selecione uma categoria.");
    return;
  }
  const pagamento = document.getElementById("formaPagamento").value;
  App.set("formaPagamento", pagamento);
  App.go("procurando.html");
}

</script>

</body>
</html>
